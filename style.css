*,
*::before,
*::after {
    box-sizing: border-box;
}

html {
    width: 100%;
    overflow-x: hidden;
}

body {
    font-family: 'Roboto', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #333;
    margin: 0;
    padding: 15px;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: center;
    min-height: 100vh;
    background-color: #eef1f5; /* Slightly cooler background */
    width: 100%;
    overflow-x: hidden;
    -webkit-tap-highlight-color: transparent;
}

.container {
    width: 100%;
    max-width: 750px;
    background: #ffffff;
    border-radius: 20px;
    padding: 20px 25px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    border: 1px solid #e9ecef;
    text-align: center;
    margin-top: 10px;
    margin-bottom: 20px;
}

/* --- Settings Panel, Buttons, etc. (No changes from previous version) --- */
header h1 { color: #2c3e50; margin-bottom: 8px; font-weight: 700; font-size: 2em; }
.instructions { font-size: 0.9em; color: #555; margin-bottom: 20px; }
.upload-section { margin-bottom: 15px; }
.file-info { font-size: 0.8em; color: #007bff; margin-top: 8px; min-height: 1.2em; }
.upload-button { background-color: #007bff; color: white; padding: 10px 20px; border-radius: 8px; cursor: pointer; display: inline-block; transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease; font-weight: 500; border: none; box-shadow: 0 3px 10px rgba(0, 123, 255, 0.2); }
.upload-button:hover { background-color: #0056b3; transform: translateY(-2px); box-shadow: 0 5px 14px rgba(0, 123, 255, 0.25); }
.settings-panel { display: flex; flex-direction: column; align-items: stretch; gap: 12px; background-color: rgba(244, 246, 248, 0.7); padding: 15px; border-radius: 12px; margin-bottom: 25px; border: 1px solid #e0e5ea; }
.setting-group { display: flex; justify-content: space-between; align-items: center; gap: 10px; }
.panel-label { font-size: 0.95em; color: #495057; font-weight: 500; white-space: nowrap; }
.mode-buttons { display: flex; background-color: #e0e5ea; border-radius: 8px; padding: 3px; }
.mode-button { padding: 7px 15px; border: none; background-color: transparent; color: #495057; font-size: 0.85em; font-weight: 500; cursor: pointer; border-radius: 6px; transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease; }
.mode-button.active { background-color: #007bff; color: white; box-shadow: 0 2px 6px rgba(0, 123, 255, 0.25); }
.mode-button:not(.active):hover { background-color: #cfd5db; }
.mode-button:disabled, .toggle-switch input:disabled + .slider-toggle { opacity: 0.6; cursor: not-allowed; }
.settings-divider { border: none; height: 1px; background-color: #d1d8e0; margin: 5px 0; }
.toggle-switch { position: relative; display: inline-block; width: 44px; height: 24px; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.slider-toggle { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
.slider-toggle:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider-toggle { background-color: #007bff; }
input:checked + .slider-toggle:before { transform: translateX(20px); }
#autoAdvanceSliderGroup { align-items: center; }
input[type="range"] { flex-grow: 1; height: 8px; -webkit-appearance: none; appearance: none; background: #d1d8e0; border-radius: 5px; outline: none; opacity: 0.9; transition: opacity .2s; }
input[type="range"]:hover { opacity: 1; }
input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 18px; height: 18px; background: #007bff; cursor: pointer; border-radius: 50%; box-shadow: 0 0 5px rgba(0,123,255,0.3); }
input[type="range"]::-moz-range-thumb { width: 18px; height: 18px; background: #007bff; cursor: pointer; border-radius: 50%; border: none; box-shadow: 0 0 5px rgba(0,123,255,0.3); }
.slider-value { font-size: 0.9em; color: #495057; min-width: 28px; text-align: right; }
/* --- End of Unchanged Section --- */

/* Flashcard Area & Stack */
.flashcard-area { position: relative; width: 100%; min-height: 380px; display: flex; justify-content: center; align-items: center; margin-bottom: 15px; perspective: 1500px; }
.flashcard-stack-bg { position: absolute; width: calc(100% - 20px); max-width: 500px; height: 340px; background-color: #e9ecef; border-radius: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.08); transition: transform 0.5s cubic-bezier(0.4, 0.0, 0.2, 1), opacity 0.5s ease; z-index: 1; }
.flashcard-stack-bg-1 { transform: scale(0.96) translateY(12px); background-color: #e0e5ea; border-radius: 30px; z-index: 2; }
.flashcard-stack-bg-2 { transform: scale(0.92) translateY(24px); background-color: #d1d8e0; border-radius: 30px; z-index: 1; }

/* Main Flashcard - Apple Glass Effect */
.flashcard { position: relative; width: 100%; max-width: 500px; height: 340px; cursor: pointer; transform-style: preserve-3d; transition: transform 0.7s cubic-bezier(0.4, 0.0, 0.2, 1); z-index: 3; }
.flashcard.swiping-left { transition: transform 0.4s ease-out, opacity 0.4s ease-out; transform: translateX(-120%) rotate(-10deg) !important; opacity: 0.3 !important; }
.flashcard.swiping-right { transition: transform 0.4s ease-out, opacity 0.4s ease-out; transform: translateX(120%) rotate(10deg) !important; opacity: 0.3 !important; }
.flashcard.is-flipped { transform: rotateY(180deg); }
.flashcard-inner { width: 100%; height: 100%; position: relative; text-align: center; transform-style: preserve-3d; }

.flashcard-front,
.flashcard-back {
    position: absolute;
    width: 100%;
    height: 100%;
    -webkit-backface-visibility: hidden; /* ** FIX: Prevents mirrored text on flip ** */
    backface-visibility: hidden;         /* ** FIX: Prevents mirrored text on flip ** */
    transform: translateZ(0);            /* ** FIX: Promotes element to new layer for better rendering */
    padding: 25px;
    border-radius: 35px; /* ** STYLE: Softer glass corner effect ** */
    overflow: hidden;    /* Crucial for containing the blurred pseudo-elements */
    display: flex;
    justify-content: center;
    align-items: center;
    background: rgba(245, 247, 250, 0.75); /* Frosted glass background */
    border: 1px solid rgba(255, 255, 255, 0.6);
    box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.7), /* Inner top highlight */
                0 15px 40px rgba(0, 0, 0, 0.12); /* Main drop shadow */
}

.flashcard-back {
    transform: rotateY(180deg) translateZ(1px); /* Add slight Z translate to ensure it's on top when flipped */
}

/* Container for text, to layer it above the smoke effects */
.card-content {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 18px;
    width: 100%;
    height: 100%;
}

/* Dynamic Smoky Gradient */
.flashcard-front::before,
.flashcard-back::before {
    content: '';
    position: absolute;
    z-index: 1; /* Behind card-content but on top of card background */
    pointer-events: none;
    /* Create a wide element to allow horizontal movement */
    left: -50%;
    top: 60%;
    width: 200%;
    height: 100%;
    /* The smoke is made of multiple large, soft, overlapping radial gradients */
    background: radial-gradient(ellipse at center, hsla(210, 80%, 70%, 0.4) 0%, transparent 40%), /* Blueish smoke */
                radial-gradient(ellipse at center, hsla(0, 80%, 75%, 0.4) 0%, transparent 45%),   /* Reddish smoke */
                radial-gradient(ellipse at center, hsla(300, 80%, 75%, 0.4) 0%, transparent 45%); /* Pinkish smoke */
    opacity: 0.7;
    filter: blur(50px); /* Heavy blur for the smoky effect */
    animation: smokeAnimation 25s infinite alternate ease-in-out;
}

@keyframes smokeAnimation {
    0% {
        /* Starting position and size of the gradient layers */
        background-size: 40% 40%, 50% 50%, 35% 35%;
        background-position: 10% 0%, 50% 0%, 90% 0%;
        transform: translateY(0);
    }
    100% {
        /* Ending position and size, creates horizontal floating and billowing */
        background-size: 50% 50%, 35% 35%, 40% 40%;
        background-position: 90% 0%, 10% 0%, 50% 0%;
        transform: translateY(-10px);
    }
}

/* Text styles */
.flashcard-front p { font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif; font-size: 3.4em; font-weight: 500; color: #343a40; margin: 0; line-height: 1.25; }
.flashcard-back p { margin: 0; line-height: 1.5; }

/* Specific colors for back of card text */
.flashcard-back .chinese-text { font-family: 'Noto Sans SC', 'Microsoft YaHei', sans-serif; font-size: 2.5em; font-weight: 500; color: black; }
.flashcard-back .pinyin-text { font-family: 'Roboto', 'Arial', sans-serif; font-size: 1.6em; color: red; }
.flashcard-back .meaning-text { font-family: 'Roboto', 'Segoe UI', sans-serif; font-size: 1.5em; color: darkblue; font-weight: 400; }

/* Card Counter & Navigation */
.card-counter-display { font-size: 0.95em; color: #495057; font-weight: 500; margin-bottom: 15px; }
.navigation-controls { display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 10px; margin-top: 0; }
.nav-button, .control-button { background-color: #f8f9fa; border: 1px solid #dee2e6; color: #343a40; padding: 10px 15px; border-radius: 8px; cursor: pointer; transition: all 0.25s ease; font-weight: 500; box-shadow: 0 2px 4px rgba(0,0,0,0.05); font-size: 0.9em; }
.nav-button:first-child { justify-self: start; }
.nav-button:last-child { justify-self: end; }
.control-button { justify-self: center; }
.nav-button:hover, .control-button:hover { background-color: #e9ecef; border-color: #ced4da; box-shadow: 0 3px 6px rgba(0,0,0,0.07); transform: translateY(-1px); }
.nav-button:disabled, .control-button:disabled { opacity: 0.65; cursor: not-allowed; background-color: #f8f9fa; box-shadow: none; transform: translateY(0); }
footer { margin-top: 30px; font-size: 0.85em; color: #6c757d; }

/* Responsive adjustments */
@media (max-width: 768px) {
    .container { padding: 15px 20px; }
    .flashcard-area { min-height: 360px; }
    .flashcard { max-width: 95%; height: 320px; }
    .flashcard-stack-bg { max-width: calc(95% - 20px); height: 320px; border-radius: 30px; }
    .flashcard-front, .flashcard-back { border-radius: 30px; }
    .flashcard-front p { font-size: 3em; }
    .flashcard-back .chinese-text { font-size: 2.2em; }
    .flashcard-back .pinyin-text { font-size: 1.4em; }
    .flashcard-back .meaning-text { font-size: 1.3em; }
    .navigation-controls { grid-template-columns: 1fr 1fr 1fr; }
}

@media (max-width: 480px) {
    body { padding: 10px 5px; }
    .container { padding: 15px; margin-top: 5px; border-radius: 15px; }
    header h1 { font-size: 1.7em; }
    .flashcard-area { min-height: 320px; margin-bottom:10px; }
    .flashcard { height: 280px; border-radius: 25px; }
    .flashcard-front, .flashcard-back { border-radius: 25px; }
    .flashcard-stack-bg { height: 280px; border-radius: 25px; }
    .flashcard-stack-bg-1 { transform: scale(0.95) translateY(8px); }
    .flashcard-stack-bg-2 { transform: scale(0.90) translateY(16px); }
    .flashcard-front p { font-size: 2.5em; }
    .flashcard-back .chinese-text { font-size: 2em; }
    .flashcard-back .pinyin-text { font-size: 1.2em; }
    .flashcard-back .meaning-text { font-size: 1.1em; }
    .flashcard-front::before, .flashcard-back::before { filter: blur(40px); }
}
